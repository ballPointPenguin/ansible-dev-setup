# code: language=ansible
---
- name: Download mise install script
  ansible.builtin.get_url:
    url: https://mise.run
    dest: /home/{{ current_user }}/bin/mise.sh
    owner: "{{ current_user }}"
    group: "{{ current_user }}"
    mode: "0644"

- name: Run the mise install script
  ansible.builtin.command: ./mise.sh
  args:
    chdir: /home/{{ current_user }}/bin
    creates: /home/{{ current_user }}/.local/bin/mise

- name: Include zsh mise plugin
  update_zsh_plugins:
    zshrc_path: "/home/{{ current_user }}/.zshrc"
    new_plugins: ["mise"]

- name: Update mise plugins
  ansible.builtin.command: |
    ~/.local/bin/mise plugins update --yes
  changed_when: false
